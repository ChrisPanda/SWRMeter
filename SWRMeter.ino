/*  SWRMeter(OLEDMeter) was written to utilize any 128x64 display. I have only seen marginal attempts to
    animate meters and I hope this one will set a standard. Please feel free to modify and share
    this code for any 128x64 LCD or OLED. OLEDMeter sketch was written for use with I2C SH1106.
    This code must be modified to work with other display devices.

    Working portion of code was taken from Adafruit Example Sound Level Sketch for the
    Adafruit Microphone Amplifier
    https://learn.adafruit.com/adafruit-microphone-amplifier-breakout/measuring-sound-levels

    Remaining code was written by Greg Stievenart with no claim to or any images or information
    provided in this code. Freely published May 26, 2016.

    Software to convert background mask to 128x64 at: http://www.ablab.in/image2glcd-software/

    IMPORTANT: Sound source must be grounded to the Arduino or other MCU's to work. Usually the
    base sleeve contact on TRS or TRRS connector is the ground.
*/
#include "fix_fft.h"
#include <Wire.h>                     // requried to run I2C SH1106
//#include <SPI.h>                      // requried to run I2C SH1106
#include <Adafruit_GFX.h>             // https://github.com/adafruit/Adafruit-GFX-Library
//#include <Adafruit_SSD1306.h>         // https://github.com/adafruit/Adafruit_SSD1306
#include <Adafruit_SH1106.h>          // https://github.com/wonho-maker/Adafruit_SH1106

#define SCREEN_WIDTH 128 // OLED display width, in pixels
#define SCREEN_HEIGHT 64 // OLED display height, in pixels

// Declaration for an SSD1306 display connected to I2C (SDA, SCL pins)
#define OLED_RESET 4                  // reset required for SH1106

Adafruit_SH1106 display(OLED_RESET);  // reset required for SH1106
//Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

#define s_meter_input A0             // S-Meter analog input
#define vu_meter_input A1             // vu-Meter analog input  
#define fwd_pwr_input A2       // forward power meter analog input
#define rev_pwr_input A3       // reverse power meter analog input

#define RecXmt_select 10             // receive transmit  select
#define Xmt_Mode_select 11             // transmit disp select  power or swr
#define Rec_Mode_select 12       // receive disp select  s-meter or vu meter
#define Alt_Mode_select 13       // alternate display mode select

#define  _S_MTR      0
#define  _VU_MTR     1
#define  _POWER      2
#define  _SWR        3
#define  _ALT        4

int lc = 0;

int analogInput = vu_meter_input;                 // analog input being read at this time
int hMeter = 65;                      // horizontal center for needle animation
int vMeter = 85;                      // vertical center for needle animation (outside of dislay limits)
int rMeter = 80;                      // length of needle animation or arch of needle travel


char im[128], data[128];                              //variables for the FFT
char x = 0, ylim = 60;                                //variables for drawing the graphics
int i = 0, val;
// sample window width in mS (50 mS = 20Hz)
unsigned int sample;                  // adc reading
unsigned int last_sample;
int dsp_Mode = _VU_MTR;

#include "SWR.h"
#include "utils.h"
// the SWR calculator
SWR swrData(fwd_pwr_input, rev_pwr_input);

///////////////////////////////////////////////////////////////////////////////
//
//  REQUIRED: numeric limits for SWR hardware sensor
//
const int BufferLength = 24;

// I/O buffer
char ioBuffer[BufferLength];

// define power limits (W); this is the power reading corresponding
//    to a full-scale A/D reading; to report the power as a percentage
//    of full scale, set this to 100.0.
#define FULL_SCALE_FORWARD (20.0)
#define FULL_SCALE_REFLECTED (20.0)

// MINIMUM A/D for SWR - this is the minimum A/D reading that will produce an
//   SWR != 1.0; this helps to prevent unnecessarily high SWR readings at low
//   power levels where there is insufficient A/D resolution to make accurate
//   SWR calculations.  This value is the RAW value used as a minimum FORWARD
//   power limit.  Below this RAW value, the SWR will be reported as 1.0.
#define MIN_POWER (5)


// Maximum Arduino A/D reading; used only to scale the power readings.
const int ARDUINO_AD_MAX = 1023;

// maximum auto-poll interval (msec)
const int MaxAutoPoll = 1000;

// compute scaling constants for power readings
const float FORWARD_SCALE = (float)FULL_SCALE_FORWARD / (float)ARDUINO_AD_MAX;
const float REFLECT_SCALE = (float)FULL_SCALE_REFLECTED / (float)ARDUINO_AD_MAX;

//////////////////////////////////////////////////////////////////////////////////

// VU meter background mask image:
static const unsigned char PROGMEM VUMeter[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x03, 0x00, 0x60, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x09, 0x04, 0x80, 0x21, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x01, 0x98, 0x08, 0x06, 0x03, 0x80, 0x21, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xA4, 0x10, 0x09, 0x00, 0x80, 0x21, 0x20, 0x07, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xA4, 0x10, 0x06, 0x03, 0x00, 0x20, 0xC0, 0x00, 0x80, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x71, 0x80, 0xA4, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x0A, 0x40, 0x98, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x3C, 0x00, 0x00,
  0x00, 0x00, 0x3A, 0x40, 0x00, 0x00, 0x02, 0x01, 0x00, 0x40, 0x80, 0x07, 0x00, 0x20, 0x00, 0x00,
  0x00, 0x00, 0x42, 0x40, 0x00, 0x08, 0x02, 0x01, 0x08, 0x40, 0x80, 0x00, 0x00, 0x38, 0x00, 0x00,
  0x00, 0x00, 0x79, 0x80, 0x04, 0x08, 0x02, 0x01, 0x08, 0x81, 0x10, 0x00, 0x00, 0x04, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x04, 0x08, 0x02, 0x01, 0x08, 0x81, 0x11, 0x04, 0x00, 0x38, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x02, 0x04, 0x02, 0x01, 0x08, 0x81, 0x21, 0x04, 0x00, 0x00, 0x08, 0x00,
  0x00, 0x00, 0x00, 0x84, 0x02, 0x04, 0x0F, 0xFF, 0xFF, 0xC3, 0xE2, 0x04, 0x00, 0x00, 0x08, 0x00,
  0x00, 0x00, 0x00, 0xC2, 0x01, 0x07, 0xF0, 0x00, 0x00, 0x3B, 0xFE, 0x08, 0x40, 0x40, 0x08, 0x00,
  0x00, 0xFE, 0x00, 0x62, 0x01, 0xF8, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xE8, 0x40, 0x80, 0x7F, 0x00,
  0x00, 0x00, 0x00, 0x21, 0x1E, 0x00, 0x04, 0x00, 0x80, 0x00, 0x7F, 0xFE, 0x80, 0x80, 0x08, 0x00,
  0x00, 0x00, 0x03, 0x31, 0xE0, 0x00, 0x04, 0x00, 0x80, 0x04, 0x01, 0xFF, 0xC1, 0x00, 0x08, 0x00,
  0x00, 0x00, 0x07, 0x1E, 0x00, 0x40, 0x00, 0x00, 0x00, 0x04, 0x00, 0x1F, 0xFA, 0x00, 0x08, 0x00,
  0x00, 0x00, 0x07, 0xF0, 0x00, 0x40, 0x3B, 0x07, 0x60, 0x00, 0x00, 0x01, 0xFF, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x03, 0x80, 0x00, 0x00, 0x34, 0x81, 0x90, 0xCC, 0xC0, 0x00, 0x3F, 0xC0, 0x00, 0x00,
  0x00, 0x00, 0x0C, 0x00, 0x03, 0x30, 0x0C, 0x82, 0x90, 0x53, 0x20, 0x00, 0x07, 0xF8, 0x00, 0x00,
  0x00, 0x00, 0x70, 0x40, 0x00, 0xC8, 0x3B, 0x02, 0x60, 0x53, 0x20, 0x00, 0x00, 0xFE, 0x00, 0x00,
  0x00, 0x01, 0x80, 0x20, 0x01, 0xC8, 0x00, 0x00, 0x00, 0x4C, 0xC0, 0x00, 0x00, 0x3F, 0x80, 0x00,
  0x00, 0x06, 0x00, 0x00, 0x03, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xE0, 0x00,
  0x00, 0x08, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFC, 0x00,
  0x00, 0x30, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x00,
  0x00, 0x00, 0x40, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,
  0x00, 0x00, 0xA0, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x44, 0x00, 0x00, 0x00, 0x02, 0x02, 0x30, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x03, 0x06, 0x30, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x01, 0x8C, 0x30, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x22, 0x00, 0x00, 0x00, 0x00, 0xD8, 0x30, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x70, 0x19, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x20, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
// PowerMeter background mask image:
static const unsigned char PROGMEM PowerMeter[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x04, 0x80, 0x06, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0xE0, 0x03, 0x00, 0x02, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x28, 0x00, 0x90, 0x04, 0x80, 0x02, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x60, 0x83, 0x01, 0x02, 0xA0, 0x06, 0xE0, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x08, 0x10, 0x00, 0x00, 0x00, 0x02, 0xE0, 0x02, 0x10, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x38, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x70, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x80, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x1C, 0x08, 0x00, 0x00, 0x02, 0x02, 0x02, 0x00, 0x00, 0x02, 0xF0, 0x06, 0x20, 0x00,
  0x00, 0x00, 0x20, 0x00, 0x00, 0x08, 0x02, 0x02, 0x02, 0x00, 0x80, 0x00, 0x00, 0x02, 0xA0, 0x00,
  0x00, 0x00, 0x3C, 0x00, 0x04, 0x08, 0x02, 0x02, 0x02, 0x00, 0x81, 0x00, 0x00, 0x82, 0xE0, 0x00,

  0x00, 0x00, 0x00, 0x00, 0x02, 0x04, 0x02, 0x03, 0x02, 0x01, 0x02, 0x00, 0x00, 0x02, 0x20, 0x00,
  0x00, 0x00, 0x00, 0x01, 0x02, 0x04, 0x0F, 0xFF, 0xFF, 0x81, 0x02, 0x04, 0x00, 0x02, 0x20, 0x00,
  0x00, 0x08, 0x00, 0x01, 0x01, 0x07, 0xF0, 0x00, 0x00, 0x7F, 0x04, 0x04, 0x10, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x20, 0x81, 0xF8, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x08, 0x30, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x20, 0x5E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xD0, 0x20, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x04, 0x11, 0xE0, 0x1F, 0x80, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x41, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x02, 0x1E, 0x00, 0x08, 0x40, 0x00, 0x00, 0x00, 0x00, 0x03, 0xC2, 0x00, 0x00, 0x00,
  0x00, 0x01, 0x01, 0xF0, 0x00, 0x08, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0x04, 0x00, 0x00,
  0x00, 0x00, 0x81, 0x00, 0x00, 0x08, 0x4F, 0x9D, 0xCF, 0x9D, 0x80, 0x00, 0x0E, 0x08, 0x00, 0x00,
  0x00, 0x20, 0x86, 0x00, 0x00, 0x0F, 0x90, 0x48, 0x90, 0x46, 0x40, 0x00, 0x01, 0x90, 0x20, 0x00,
  0x00, 0x10, 0x70, 0x00, 0x00, 0x08, 0x10, 0x4A, 0x9F, 0xC4, 0x00, 0x00, 0x00, 0x70, 0x40, 0x00,
  0x00, 0x01, 0x80, 0x00, 0x00, 0x08, 0x10, 0x4A, 0x90, 0x04, 0x00, 0x00, 0x00, 0x0C, 0x00, 0x00,
  0x00, 0x0E, 0x00, 0x00, 0x00, 0x08, 0x10, 0x45, 0x10, 0x44, 0x00, 0x00, 0x00, 0x03, 0x80, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x0F, 0x85, 0x0F, 0x9F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00


};
// vswrMeter background mask image:
static const unsigned char PROGMEM vswrMeter[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x80, 0x82, 0x80, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x81, 0x03, 0x83, 0x81, 0x00, 0x00, 0xE0, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x18, 0x03, 0x02, 0x04, 0x00, 0x81, 0xC0, 0x61, 0x10, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x20, 0x04, 0x84, 0x07, 0x80, 0x81, 0x20, 0x90, 0x10, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x38, 0x03, 0x08, 0x10, 0x04, 0x00, 0xC0, 0x60, 0x10, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x20, 0x24, 0x10, 0x0F, 0x00, 0x00, 0x04, 0x00, 0x90, 0x60, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0xA0, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x10, 0xE0, 0x00, 0x00,
  0x00, 0x00, 0x00, 0xE0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x10, 0x10, 0x00, 0x00,
  0x01, 0x00, 0x00, 0x20, 0x00, 0x00, 0x02, 0x02, 0x02, 0x00, 0x00, 0x01, 0x10, 0x70, 0x00, 0x00,
  0x07, 0x03, 0x80, 0x20, 0x00, 0x08, 0x02, 0x02, 0x02, 0x00, 0x80, 0x00, 0xE0, 0x80, 0x40, 0x00,
  0x01, 0x00, 0x41, 0x00, 0x04, 0x08, 0x02, 0x02, 0x02, 0x00, 0x81, 0x00, 0x00, 0xF1, 0x40, 0x00,
  0x01, 0x01, 0xC0, 0x00, 0x02, 0x04, 0x02, 0x03, 0x02, 0x01, 0x02, 0x00, 0x02, 0x01, 0xC0, 0x00,
  0x01, 0x02, 0x00, 0x01, 0x02, 0x04, 0x0F, 0xFF, 0xFF, 0x81, 0x02, 0x04, 0x00, 0x00, 0x41, 0x80,
  0x01, 0x03, 0xC0, 0x01, 0x01, 0x07, 0xF0, 0x00, 0x00, 0x7F, 0x04, 0x04, 0x10, 0x00, 0x42, 0x00,
  0x01, 0x08, 0x00, 0x20, 0x81, 0xF8, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x08, 0x30, 0x02, 0x03, 0x80,
  0x01, 0x00, 0x00, 0x20, 0x5E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xD0, 0x20, 0x00, 0x02, 0x40,
  0x07, 0xC0, 0x04, 0x11, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x41, 0x00, 0x01, 0x80,
  0x00, 0x00, 0x02, 0x1E, 0x00, 0x03, 0xB9, 0xF3, 0xBB, 0xF0, 0x00, 0x03, 0xC2, 0x00, 0x08, 0x00,
  0x00, 0x01, 0x01, 0xF0, 0x00, 0x01, 0x12, 0x09, 0x11, 0x08, 0x00, 0x00, 0x7C, 0x04, 0x00, 0x00,
  0x00, 0x00, 0x83, 0x80, 0x00, 0x01, 0x12, 0x01, 0x11, 0x08, 0x00, 0x00, 0x0E, 0x08, 0x00, 0x00,
  0x00, 0x20, 0x8C, 0x00, 0x00, 0x01, 0x12, 0x01, 0x11, 0x08, 0x00, 0x00, 0x01, 0x90, 0x20, 0x00,
  0x00, 0x10, 0x70, 0x00, 0x00, 0x00, 0xA1, 0xF1, 0x51, 0xF0, 0x00, 0x00, 0x00, 0x70, 0x40, 0x00,
  0x00, 0x01, 0x80, 0x00, 0x00, 0x00, 0xA0, 0x09, 0x51, 0x20, 0x00, 0x00, 0x00, 0x0C, 0x00, 0x00,
  0x00, 0x0E, 0x00, 0x00, 0x00, 0x00, 0xA0, 0x09, 0x51, 0x20, 0x00, 0x00, 0x00, 0x03, 0x80, 0x00,
  0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x42, 0x08, 0xA1, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x41, 0xF0, 0xA3, 0x98, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
//  S_Meter background image
static const unsigned char PROGMEM S_Meter[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x60, 0xE0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x80, 0x80, 0x21, 0x20, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x28, 0xE0, 0xE0, 0x40, 0xC1, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x38, 0x38, 0x10, 0x90, 0x81, 0x20, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x04, 0x08, 0xE0, 0x60, 0x80, 0xC0, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x38, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x04, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x33, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x1C, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x80, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x18, 0x20, 0x00, 0x00, 0x02, 0x04, 0x08, 0x40, 0x80, 0x3C, 0x82, 0xC0, 0x00, 0x00,
  0x00, 0x00, 0x08, 0x3C, 0x00, 0x08, 0x02, 0x04, 0x08, 0x40, 0x80, 0x33, 0x0B, 0x20, 0x00, 0x00,
  0x00, 0x00, 0x08, 0x00, 0x08, 0x08, 0x02, 0x04, 0x08, 0x81, 0x10, 0x00, 0x0F, 0x20, 0x00, 0x00,
  0x00, 0x00, 0x08, 0x00, 0x08, 0x08, 0x02, 0x04, 0x08, 0x81, 0x11, 0x00, 0x02, 0xC0, 0x00, 0x00,
  0x00, 0x00, 0x08, 0x02, 0x02, 0x04, 0x02, 0x04, 0x08, 0x81, 0x21, 0x04, 0x00, 0x04, 0xC0, 0x00,
  0x00, 0x00, 0x00, 0x81, 0x02, 0x04, 0x0F, 0xFF, 0xFF, 0xC3, 0xE2, 0x04, 0x00, 0x09, 0x20, 0x00,
  0x00, 0x00, 0x00, 0xC1, 0x01, 0x07, 0xF0, 0x00, 0x00, 0x3B, 0xFE, 0x08, 0x40, 0x0F, 0x20, 0x00,
  0x00, 0x00, 0x00, 0x60, 0x81, 0xF8, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xE8, 0x40, 0x8A, 0xC0, 0x00,
  0x00, 0x00, 0x00, 0x20, 0x5E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xFE, 0x80, 0x86, 0x00, 0x00,
  0x00, 0x00, 0x02, 0x31, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xC1, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x03, 0x1E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xFA, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x01, 0xF0, 0x03, 0xC0, 0x22, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFF, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x03, 0x80, 0x04, 0x00, 0x36, 0x00, 0x80, 0x00, 0x00, 0x00, 0x3F, 0xC0, 0x00, 0x00,
  0x00, 0x00, 0x0C, 0x00, 0x04, 0x00, 0x36, 0x79, 0xE3, 0xCD, 0x80, 0x00, 0x07, 0xF8, 0x00, 0x00,
  0x00, 0x00, 0x70, 0x00, 0x07, 0xC0, 0x2A, 0x84, 0x84, 0x26, 0x00, 0x00, 0x00, 0xFE, 0x00, 0x00,
  0x00, 0x01, 0x80, 0x00, 0x00, 0x4F, 0x2A, 0xFC, 0x87, 0xE4, 0x00, 0x00, 0x00, 0x3F, 0x80, 0x00,
  0x00, 0x06, 0x00, 0x00, 0x00, 0x40, 0x22, 0x80, 0x84, 0x04, 0x00, 0x00, 0x00, 0x07, 0xE0, 0x00,
  0x00, 0x08, 0x00, 0x00, 0x07, 0x80, 0x22, 0x78, 0x63, 0xCF, 0x00, 0x00, 0x00, 0x01, 0xFC, 0x00,
  0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};








void setup() {

  // analog input for outside  source
  pinMode(s_meter_input, INPUT);
  pinMode(vu_meter_input, INPUT);
  pinMode(fwd_pwr_input, INPUT);
  pinMode(rev_pwr_input, INPUT);


  pinMode(RecXmt_select, INPUT_PULLUP);
  pinMode(Xmt_Mode_select, INPUT_PULLUP);
  pinMode(Rec_Mode_select, INPUT_PULLUP);
  pinMode(Alt_Mode_select, INPUT_PULLUP);

  display.begin(SH1106_SWITCHCAPVCC, 0x3C);   // needed for SH1106 display
  // display.begin(SSD1306_SWITCHCAPVCC, 0x3D);    // Address 0x3D for 128x64


  display.clearDisplay();      // clears display from any library info displayed
  // display.invertDisplay(1);     // option to invert display to black on white
  dsp_Mode = _VU_MTR;            // start with default vu meter
  Serial.begin(9600);
}

void loop() {
  swrData.Poll();

  /***********************************************************************
    Code to use digital pins to select display type
  ************************************************************************/
  //select_dspMode();

  while (dsp_Mode == _VU_MTR) {
    dsp_VU_Meter();
    //select_dspMode();
  }
  while (dsp_Mode == _S_MTR) {
    dsp_S_Meter();
    //select_dspMode();
  }
  while (dsp_Mode == _POWER) {
    dsp_PWR_Meter();
    //select_dspMode();
  }

  while (dsp_Mode == _SWR) {
    dsp_SWR_Meter();
    //select_dspMode();
  }

  while (dsp_Mode == _ALT) {
    dsp_FFT();
    //select_dspMode();
  }
}

/***********************************************************************
  Sample code to display each available display mode in sequence
***********************************************************************


  while (dsp_Mode == _VU_MTR) {
  dsp_VU_Meter();
  lc++;
  if (lc > 100) {
    dsp_Mode ++;
    lc = 0;
  }
  }
  while (dsp_Mode == _S_MTR) {
  dsp_S_Meter();
  lc++;
  if (lc > 100) {
    dsp_Mode++;
    lc = 0;
  }
  }
  while (dsp_Mode == _POWER) {
  dsp_PWR_Meter();
  lc++;
  if (lc > 100) {
    dsp_Mode++;
    lc = 0;
  }
    }
   while (dsp_Mode == _SWR  ) {
  dsp_SWR_Meter();
  lc++;
  if (lc > 100) {
    dsp_Mode++;
    lc = 0;
  }
    }
    while (dsp_Mode == _ALT ) {
  dsp_FFT();
  lc++;
  if (lc > 100) {
    dsp_Mode++;
    lc = 0;
  }
  }
  if (dsp_Mode > 4) {
  dsp_Mode = 0;
  lc = 0;
  }
************* END sample display mode *************/

// ***************** End of Loop ************

void  dsp_VU_Meter() {
  unsigned long startMillis = millis();  // start of sample window
  int sampleWindow = 50;                  // 50 ms20 Hz.
  unsigned int PeaktoPeak = 0;                             // peak-to-peak level
  unsigned int SignalMax = 0;
  unsigned int SignalMin = 1024;
  while ( millis() - startMillis < sampleWindow ) {
    //sample = analogRead(vu_meter_input);
    sample = random (1024);      
    if (sample < 1024) {
      if (sample > SignalMax) {
        SignalMax = sample;                                // saves just the max levels
      }
      else if (sample < SignalMin) {
        SignalMin = sample;                                // saves just the min levels
      }
    }
  }
  PeaktoPeak = SignalMax - SignalMin;                      // max - min = peak-peak amplitude
  float MeterValue = PeaktoPeak * 330 / 1024;              // convert volts to arrow information

  /****************************************************
    End of code taken from Adafruit Sound Level Sketch
  *****************************************************/

  MeterValue = MeterValue - 34;                            // shifts needle to zero position
  display.clearDisplay();                                  // refresh display for next step
  display.drawBitmap(0, 0, VUMeter, 128, 64, WHITE);       // draws background
  int a1 = (hMeter + (sin(MeterValue / 47.296) * rMeter)); // meter needle horizontal coordinate
  int a2 = (vMeter - (cos(MeterValue / 47.296) * rMeter)); // meter needle vertical coordinate
  display.drawLine(a1, a2, hMeter, vMeter, WHITE);         // draws needle
  display.display();

}

void dsp_PWR_Meter() {
  unsigned long startMillis = millis();  // start of sample window
  int sampleWindow = 50;                  // 50 ms 20 Hz.
  int adc = 0;
  int fwd_pwr = 0;
  int adc_offset = 0;                     // used to adjust meter zero if a dc offset to signal
  float MeterValue;  //  convert volts to arrow information
  while ( millis() - startMillis < sampleWindow ) {
    // get max value over 50 ms window
    adc = analogRead(fwd_pwr_input);
    if (adc < 1024) {
      if (adc > fwd_pwr) {
        fwd_pwr = adc;                                // saves just the max levels
      }
    }
  }
  MeterValue = map( fwd_pwr, 0, 1023 , 0, 62 - adc_offset);       // scale ADC value to meter width
  MeterValue = MeterValue - 36 + adc_offset;                          // shifts needle to zero position
  display.clearDisplay();                                  // refresh display for next step
  display.drawBitmap(0, 0, PowerMeter, 128, 64, WHITE);       // draws background
  int a1 = (hMeter + (sin(MeterValue / 47.296) * rMeter)); // meter needle horizontal coordinate
  int a2 = (vMeter - (cos(MeterValue / 47.296) * rMeter)); // meter needle vertical coordinate
  display.drawLine(a1, a2, hMeter, vMeter, WHITE);         // draws needle
  display.display();
}
void dsp_S_Meter() {
  unsigned long startMillis = millis();  // start of sample window
  int sampleWindow = 50;                  // 50 ms 20 Hz.
  int adc = 0;
  int s_units = 0;
  int adc_offset = 0;                     // used to adjust meter zero if a dc offset to signal
  float MeterValue;  //  convert volts to arrow information
  while ( millis() - startMillis < sampleWindow ) {
    // get max value over 50 ms window
    adc = analogRead(s_meter_input);
    if (adc < 1024) {
      if (adc > s_units) {
        s_units = adc;                                // saves just the max levels
      }
    }
  }
  MeterValue = map( s_units, 0, 1023 , 0, 62 - adc_offset);       // scale ADC value  range to meter width
  MeterValue = MeterValue - 36 + adc_offset;                          // shifts needle to zero position
  display.clearDisplay();                                  // refresh display for next step
  display.drawBitmap(0, 0, S_Meter, 128, 64, WHITE);       // draws background
  int a1 = (hMeter + (sin(MeterValue / 47.296) * rMeter)); // meter needle horizontal coordinate
  int a2 = (vMeter - (cos(MeterValue / 47.296) * rMeter)); // meter needle vertical coordinate
  display.drawLine(a1, a2, hMeter, vMeter, WHITE);         // draws needle
  display.display();
}


void dsp_SWR_Meter() {
  unsigned long startMillis = millis();  // start of sample window
  int sampleWindow = 50;                  // 50 ms 20 Hz.
  int adcf = 0;
  int adcr = 0;
  float pwr_rev = 0;
  float pwr_fwd = 0;
  int adc_offset = 0;
  float swr = 0;   // used to adjust meter zero if a dc offset to signal
  float MeterValue;  //  convert volts to arrow information
  /*
  while ( millis() - startMillis < sampleWindow ) {
    // get max value over 50 ms window
    //adcf = analogRead(fwd_pwr_input);
    //adcr = analogRead(rev_pwr_input);
    adcf = random (1024);
    adcr = random (1024);
    Serial.println(adcr);
    if (adcf < 1024) {
      if (adcf > pwr_fwd) {
        pwr_fwd = adcf;
        pwr_rev = adcr;    // saves just the max levels
      }
    }
  }
  */


//  swr = ((pwr_fwd + pwr_rev) / (pwr_fwd - pwr_rev) ) * 10;       
    swr = random (10);
  
  MeterValue = map(int(swr), 0, 1023 , 0, 62 - adc_offset);      // type cast to int and scale for meter range
  MeterValue = MeterValue - 36 + adc_offset;                     // shifts needle to zero position
  display.clearDisplay();                                  // refresh display for next step
  display.drawBitmap(0, 0, vswrMeter, 128, 64, WHITE);       // draws background
  int a1 = (hMeter + (sin(MeterValue / 47.296) * rMeter)); // meter needle horizontal coordinate
  int a2 = (vMeter - (cos(MeterValue / 47.296) * rMeter)); // meter needle vertical coordinate
  display.drawLine(a1, a2, hMeter, vMeter, WHITE);         // draws needle
  display.display();


  //  SWR: read A/D and compute SWR
  FormatFloat(ioBuffer, sizeof(ioBuffer), swrData.Value());
  Serial.print("SWR=");
  Serial.println(ioBuffer);
  //  RAW: read A/D and output raw values
  snprintf(ioBuffer, sizeof(ioBuffer), "%d", swrData.ForwardRaw());
   // Serial.print("ForwardRaw=");
   // Serial.println(ioBuffer);
    
  snprintf(ioBuffer, sizeof(ioBuffer), "%d", swrData.ReflectedRaw());
    //  Serial.print("ReflectedRaw=");
   // Serial.println(ioBuffer);
}


void select_dspMode() {

  if (digitalRead(RecXmt_select) == LOW) {
    if (digitalRead(Xmt_Mode_select) == LOW)dsp_Mode = _SWR;
    else dsp_Mode = _POWER;
  }
  else if (digitalRead(Rec_Mode_select) == LOW)
    dsp_Mode = _VU_MTR;
  else  dsp_Mode = _S_MTR;

}


void dsp_FFT() {
  int min = 1024, max = 0;                            //set minumum & maximum ADC values
  for (i = 0; i < 128; i++) {                         //take 128 samples
    val = analogRead(vu_meter_input);                             //get audio from Analog 1
    data[i] = val / 2 - 128;                          //each element of array is val/4-128
    im[i] = 0;                                        //
    if (val > max) max = val;                         //capture maximum level
    if (val < min) min = val;                         //capture minimum level
  };

  fix_fft(data, im, 7, 0);                            //perform the FFT on data

  display.clearDisplay();                             //clear display
  for (i = 1; i < 64; i++) {                          // In the current design, 60Hz and noise
    int dat = 3 * sqrt(data[i] * data[i] + im[i] * im[i]); //filter out noise and hum

    display.drawLine(i * 2 + x, ylim, i * 2 + x, ylim - dat, WHITE); // draw bar graphics for freqs above 500Hz to buffer
  };
  display.setTextColor(WHITE);
  display.setCursor(0, 0);                            //set cursor to top of screen
  display.print("  Audio Spectrum");             //print title to buffer
  display.display();                                  //show the buffer
}
